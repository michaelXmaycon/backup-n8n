{"createdAt":"2025-07-01T13:03:42.286Z","updatedAt":"2025-07-01T13:03:42.286Z","id":"OprB33g6wbWV7OrY","name":"Sistema_Criador_De_V_deos_Curtos_1_0__roogerAmaralYT","active":false,"isArchived":false,"nodes":[{"parameters":{"assignments":{"assignments":[{"id":"84924182-8e05-4bc6-b8b6-3863c1be0f06","name":"User Input","value":"={{ $json['T√≠tulo do V√≠deo'] }}","type":"string"},{"id":"02602696-d3ad-4aeb-9d18-e80c6cf2ec17","name":"Script Duration","value":"={{ $json.Dura√ß√£o }}","type":"string"},{"id":"c1d43d39-97de-45fa-bbe4-6b993378191b","name":"Status","value":2980,"type":"number"},{"id":"5fe2b8ea-aa8c-4edb-b3bb-9df2f445662c","name":"Provedor Imagens","value":"={{ $json['Provedor Imagens'] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[480,180],"id":"80e02131-04b3-41bf-a7c8-4c119a050cd3","name":"Set Idea"},{"parameters":{"content":"## Criar T√≠tulo, Descri√ß√£o e Script","height":580,"width":2080,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[420,20],"id":"11c3dc6c-63ba-487f-bd47-153bcd03658d","name":"Sticky Note"},{"parameters":{"formTitle":"Sistema Criador De V√≠deos Curtos 1.0","formDescription":"Criador de v√≠deos narrados e legendados.","formFields":{"values":[{"fieldLabel":"T√≠tulo do V√≠deo","fieldType":"textarea","placeholder":"Digite um t√≠tulo para o v√≠deo","requiredField":true},{"fieldLabel":"Dura√ß√£o","fieldType":"dropdown","fieldOptions":{"values":[{"option":"15 segundos"},{"option":"30 segundos"},{"option":"60 segundos"},{"option":"120 segundos"}]}},{"fieldLabel":"Estilo Generativo","fieldType":"dropdown","fieldOptions":{"values":[{"option":"3D Render"},{"option":"Anime"},{"option":"Cartoon flat, bold outline"},{"option":"Cel-shaded anime light"},{"option":"Disney Pixar"},{"option":"Hand-Drawn"},{"option":"Stick Figure, 2D"},{"option":"Hyper-Realistic"},{"option":"Minimalist vector"},{"option":"Pixel-art chibi (16-bit)"}]}},{"fieldLabel":"Tipo de V√≠deo","fieldType":"dropdown","fieldOptions":{"values":[{"option":"Ideia do Usu√°rio"},{"option":"Transcri√ß√£o"}]},"requiredField":true},{"fieldLabel":"TTS Voz","fieldType":"dropdown","fieldOptions":{"values":[{"option":"af_bella"},{"option":"af_heart"},{"option":"bm_v0george"},{"option":"ef_dora"},{"option":"em_alex"},{"option":"em_santa"},{"option":"jf_gongitsune"},{"option":"pf_dora"}]},"requiredField":true},{"fieldLabel":"Provedor Imagens","fieldType":"dropdown","fieldOptions":{"values":[{"option":"togetherai"}]},"requiredField":true}]},"options":{"appendAttribution":false,"ignoreBots":true}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[220,180],"id":"0e8a3df5-9f5a-405e-bcfc-7dd53849fdba","name":"On form submission","webhookId":"86f080b2-e18b-4573-aed3-2118fc727f4d"},{"parameters":{"schemaType":"manual","inputSchema":"{\n  \"type\": \"object\",\n  \"properties\": {\n    \"Title\": {\n      \"type\": \"string\",\n      \"description\": \"T√≠tulo curto e envolvente, motivado pela curiosidade.\"\n},\n  \"Description\": {\n    \"type\": \"string\",\n    \"description\": \"Descri√ß√£o curta com hashtags principais, gancho, contexto, CTA e hashtags.\"\n},\n  \"Hook\": {\n    \"type\": \"string\",\n    \"description\": \"Introdu√ß√£o.\"\n},\n  \"MainScript\": {\n    \"type\": \"string\",\n    \"description\": \"Conte√∫do do roteiro principal.\"\n},\n  \"CTA\": {\n    \"type\": \"string\",\n    \"description\": \"Chamada para a√ß√£o\"\n}\n},\n  \"required\": [\"T√≠tulo\", \"Descri√ß√£o\", \"Introdu√ß√£o\", \"MainScript\"]\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[1660,420],"id":"eb93cddb-e0a8-4d3a-bcc3-d343acf7d549","name":"Structured Output Parser1"},{"parameters":{"promptType":"define","text":"=Tema Do V√≠deo:\n{{ $('Set Idea').item.json['User Input'] }}\n\nDura√ß√£o Aproximada:\n{{ $('Set Idea').item.json['Script Duration'] }}","messages":{"messageValues":[{"message":"=Voc√™ √© **ShortVideoCopywriterGPT**, roteirista especializado em v√≠deos verticais (TikTok, Reels, Shorts).\n\nINPUT (do usu√°rio)  \n1. Tema do v√≠deo (string)  \n2. Dura√ß√£o aproximada em segundos (D)  \n\nOBJETIVO  \n‚Ä¢ Criar um roteiro VIRAL, DIN√ÇMICO e ORIGINAL que caiba na dura√ß√£o solicitada.  \n‚Ä¢ Use a m√©trica-guia de 3 PALAVRAS POR SEGUNDO.  \n‚ÄÉLimite-alvo = D √ó 3 palavras (toler√¢ncia ¬± 5).  \n‚Ä¢ Conte as palavras de Hook + MainScript + CTA; se estiver fora do intervalo, ajuste antes de responder.\n\n**Formato de Sa√≠da:**\n- **T√≠tulo:** [T√≠tulo cativante e instigante, baseado na ideia do usu√°rio]\n- **Descri√ß√£o:** [Resumo conciso de 50 a 150 caracteres com hashtags relevantes para o t√≥pico do usu√°rio]\n- **Gancho:** [Uma frase de abertura que chame a aten√ß√£o, inspirada na ideia do usu√°rio]\n- **Script Principal:** [Um roteiro natural, falado, sem quebras de linha ou emojis, adaptado √† dura√ß√£o do v√≠deo definida pelo usu√°rio]\n- **Chamada para A√ß√£o:** [Uma mensagem convincente que incentive os espectadores a se envolverem, como \"Qual foi a sua parte favorita desta hist√≥ria?\" ou \"Quer explorar mais ideias? Siga para saber mais!\"]\n\nREGRAS OBRIGAT√ìRIAS  \n1. N√£o adicione quebras de linha nem emojis em Hook, MainScript ou CTA.  \n2. Evite termos NSFW, marcas registradas ou men√ß√µes a pessoas reais.  \n3. Use linguagem simples, frases curtas e um dado surpresa nos primeiros 2 segundos.  \n4. Pense em imagens simples que o Flux Shell renderiza bem (cartoon/flat, cores vivas), mas **n√£o** inclua refer√™ncias visuais no JSON.  \n5. Devolva **apenas** o JSON no formato acima.  \n6. Hooks devem ser variados, evite repetir estrutura em roteiros consecutivos.  \n7. MainScript: Voc√™ n√£o deve fazer promessas de tempo de execu√ß√£o (por ex. ‚Äòem 30 minutos‚Äô) a menos que haja evid√™ncia concreta.  \n8. N√£o use aspas duplas (\") no conte√∫do do campo \"Script Principal\". Use aspas simples (') se for necess√°rio indicar uma cita√ß√£o ou destaque textual. Isso garante que a sa√≠da seja um JSON limpo e compat√≠vel com sistemas de automa√ß√£o como n8n."}]}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.5,"position":[1100,280],"id":"59e15444-4621-4045-9cc1-9c578749c276","name":"Script Writier üß†"},{"parameters":{"promptType":"define","text":"=User Input: {{ $json.text }}","hasOutputParser":true,"messages":{"messageValues":[{"message":"=Considere a entrada e a sa√≠da do usu√°rio na seguinte estrutura JSON. N√ÉO altere ou altere nenhum texto.\n\n{\n\"type\": \"object\",\n\"properties\": {\n\"Title\": {\n\"type\": \"string\",\n\"description\": \"T√≠tulo curto e envolvente, motivado pela curiosidade.\"\n},\n\"Description\": {\n\"type\": \"string\",\n\"description\": \"Descri√ß√£o curta com hashtags principais, gancho, contexto, CTA e hashtags.\"\n},\n\"Hook\": {\n\"type\": \"string\",\n\"description\": \"O gancho.\"\n},\n\"MainScript\": {\n\"type\": \"string\",\n\"description\": \"Conte√∫do do script principal.\"\n},\n\"CTA\": {\n\"type\": \"string\",\n\"description\": \"Chamada para a√ß√£o\"\n}\n},\n\"required\": [\"T√≠tulo\", \"Descri√ß√£o\", \"Introdu√ß√£o\", \"Script Principal\"]\n}"}]}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.5,"position":[1500,180],"id":"253ff738-b2fb-4a28-b63a-ce5f278b55b1","name":"Output Parser üõ†"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $('On form submission').item.json['Video Type'] }}","rightValue":"From transcript","operator":{"type":"string","operation":"equals"},"id":"67835e1a-7770-4d3e-b9d6-0dac59a5923a"}],"combinator":"and"},"renameOutput":true,"outputKey":"From transcript"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"171a9dfd-59a3-49a4-af28-c284abc85f13","leftValue":"","rightValue":"","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"User Idea"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[860,180],"id":"019b8515-0ac1-4f35-8e9a-d178cc808c82","name":"Switch"},{"parameters":{"promptType":"define","text":"=A Transcri√ß√£o:\n{{ $json['User Input'] }}","messages":{"messageValues":[{"message":"=Atuar como um roteirista de v√≠deos do YouTube especializado em transformar insights, fatos interessantes e principais conclus√µes em roteiros de v√≠deo envolventes e concisos. Seu objetivo √© criar roteiros curtos e atraentes com base nas ideias mais intrigantes de transcri√ß√µes longas de podcasts, apresentando-os como conte√∫do original e atual, sem referenciar fontes ou nomes.\n\nSeu roteiro deve ser envolvente, din√¢mico e f√°cil de acompanhar, transformando ideias complexas em narrativas empolgantes e de f√°cil assimila√ß√£o. Use um tom coloquial, descri√ß√µes v√≠vidas e um gancho forte para prender a aten√ß√£o instantaneamente. Mantenha o ritmo √°gil, garantindo que cada segundo conte.\n\nDiretrizes importantes:\n- N√ÉO use asteriscos (*) ou emojis. Mantenha o texto limpo e formatado naturalmente.\n- N√ÉO inclua quebras de linha no \"MainScript\", a menos que seja necess√°rio para facilitar a leitura. Escreva em um estilo natural e falado, como se estivesse sendo narrado por uma pessoa.\n- O roteiro deve ser ORIGINAL e coloquial, sem refer√™ncias diretas a podcasts, apresentadores ou epis√≥dios espec√≠ficos. - O Call to Action deve ser simples e envolvente. Exemplos: \"Qual foi o seu insight favorito?\" ou \"Quer mais ideias como esta? Siga para mais!\"\n\nFormato de Sa√≠da:\n- T√≠tulo: [T√≠tulo cativante e instigante]\n- Descri√ß√£o: [50-150 caracteres, resumo conciso com hashtags importantes]\n- Gancho: [Uma frase de abertura que chame a aten√ß√£o]\n- MainScript: [Um roteiro natural e falado ‚Äî SEM asteriscos, SEM emojis, SEM formata√ß√£o desnecess√°ria]\n- Call to Action: [Um prompt atraente que incentive os espectadores a se envolverem]\n\nGaranta que o MainScript seja fluido e envolvente, como se esses insights estivessem sendo compartilhados em primeira m√£o. Mantenha tudo contundente e direto, garantindo alta reten√ß√£o e engajamento."}]}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.5,"position":[1100,120],"id":"bb505f2a-f0e3-4858-9a96-504cfbbbdb7d","name":"Long form to Script Writier üß†"},{"parameters":{"assignments":{"assignments":[{"id":"7cd1dc03-8331-44ba-bda9-848145bab939","name":"Main Script","value":"={{ $json.output.Hook }} {{ $json.output.MainScript }} {{ $json.output.CTA }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1840,180],"id":"f810e66a-01f0-46dd-95d4-5f78d99d0346","name":"Combine"},{"parameters":{"assignments":{"assignments":[{"id":"bfd6c0e6-93c2-496a-8f3d-9ebc3061e78f","name":"Script","value":"={{$json['Main Script']\n  .replace(/\\n{2,}/g, \"\")      // Remove multiple newlines\n  .replace(/\\*(.*?)\\*/g, \"$1\") // Remove asterisks around words\n}}\n","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2060,180],"id":"956b248d-7fd4-4e66-af26-d54501bfbaa7","name":"Format Cleanup"},{"parameters":{"method":"POST","url":"http://host.docker.internal:85/api/user-files/upload-file/","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Token zR3mwIRhRnlixpCMmTar1ee7WegU1ZGy"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"parameterType":"formBinaryData","name":"file","inputDataFieldName":"captionsFile"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[4300,180],"id":"30681e1a-19af-4d22-9202-6e9374e3b23b","name":"Upload captions To Baserow"},{"parameters":{"method":"POST","url":"http://host.docker.internal:85/api/user-files/upload-file/","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Token zR3mwIRhRnlixpCMmTar1ee7WegU1ZGy"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"parameterType":"formBinaryData","name":"file","inputDataFieldName":"data"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[3380,400],"id":"78812778-b84f-4004-9a94-9ae3993d48a0","name":"Upload tts to baserow"},{"parameters":{"content":"## Gerar Narra√ß√£o & Legenda\n","height":580,"width":2280,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2520,20],"id":"0a214c5a-86d9-4ee8-8322-e2353c83896d","name":"Sticky Note1"},{"parameters":{"method":"POST","url":"http://host.docker.internal:8880/v1/audio/speech/","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"kokoro\",\n  \"input\": \"{{ $json.Script }}\",\n  \"voice\": \"{{ $json['TTS Voz'] }}\",\n  \"response_format\": \"mp3\",\n  \"download_format\": \"mp3\",\n  \"speed\": 1,\n  \"lang_code\": \"p\"\n}","options":{"response":{"response":{"fullResponse":true}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[3100,180],"id":"015c3945-91d7-4031-aa2a-19a08362f9b4","name":"Generate TTS"},{"parameters":{"method":"POST","url":"https://api.groq.com/openai/v1/audio/transcriptions","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"bearer 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"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"model","value":"whisper-large-v3-turbo"},{"name":"temperature","value":"0"},{"name":"response_format","value":"verbose_json"},{"name":"language","value":"pt"},{"parameterType":"formBinaryData","name":"file","inputDataFieldName":"data"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[3380,180],"id":"481ac9ce-beee-41e6-aa51-32a377df109d","name":"Criar Legenda"},{"parameters":{"jsCode":"// 1) Par√¢metros de controle\nconst MAX_CHARS = 40;   // m√°ximo de caracteres por legenda\nconst segments = items[0].json.segments || [];\n\n// 2) Transforma o texto e timestamps em legendas ‚Äúcortadas‚Äù\nconst captions = [];\n\nfor (const seg of segments) {\n  const words = seg.text.trim().split(\" \");\n  let line = \"\";\n  let startTime = null;\n\n  for (const w of words) {\n    // Se ainda n√£o iniciou a linha, define startTime\n    if (line === \"\") {\n      startTime = seg.start + seg.text.indexOf(w) / seg.text.length * (seg.end - seg.start);\n      // (este c√°lculo √© s√≥ aproximado; para precis√£o palavra-a-palavra voc√™ precisaria dos timepoints)\n    }\n    // Se adicionar esta palavra ultrapassa o limite de chars, fecha a linha atual\n    if ((line + \" \" + w).trim().length > MAX_CHARS) {\n      captions.push({ word: line.trim(), start_time: startTime, end_time: seg.start + (seg.text.indexOf(w) / seg.text.length) * (seg.end - seg.start) });\n      line = w;\n      startTime = seg.start + seg.text.indexOf(w) / seg.text.length * (seg.end - seg.start);\n    } else {\n      line = (line + \" \" + w).trim();\n    }\n  }\n  // Fecha a √∫ltima linha do segmento\n  if (line) {\n    captions.push({ word: line, start_time: startTime, end_time: seg.end });\n  }\n}\n\n// 3) Embaralha de volta num formato de itens para o pr√≥ximo n√≥\nreturn captions.map(c => ({ json: c }));\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[3640,180],"id":"1eda4033-9621-4526-98b2-b8a1179e53db","name":"Frases Curtas"},{"parameters":{"jsCode":"// 1) Pega o ID do node anterior (mesmo se estiver pinado)\nconst originalId = $('Buscar tabelas 1').all()[0].json.id;\n\n// 2) Constr√≥i o array de legendas\nconst captionsArray = items.map(i => ({\n  text: i.json.text,\n  start_time: i.json.start,\n  end_time: i.json.end,\n}));\n\n// 3) Serializa e converte para buffer\nconst jsonString = JSON.stringify(captionsArray, null, 2);\nconst buffer = Buffer.from(jsonString);\n\n// 4) Retorna com ID + buffer\nreturn [{\n  json: { id: originalId },\n  binary: {\n    captionsFile: {\n      data: buffer,\n      fileName: 'captions.json',\n      mimeType: 'application/json',\n    }\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[4060,180],"id":"e178c0cd-1b8b-4525-a595-8a469f40d746","name":"Legenda.json"},{"parameters":{"aggregate":"aggregateAllItemData","include":"specifiedFields","fieldsToInclude":"id","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[4120,680],"id":"b915286f-9420-44fa-9db8-ed545dc0f0e6","name":"Aggregate3"},{"parameters":{"jsCode":"// Initialize an array to hold IDs\nconst ids = [];\n\n// Loop over input items\nfor (const item of $input.all()) {\n  // Loop through each 'data' array\n  for (const dataItem of item.json.data) {\n    // Check if 'id' is defined\n    if (dataItem.id) {\n      // Push the ID into the array\n      ids.push(dataItem.id);\n    }\n  }\n}\n\n// Return the array wrapped in an object\nreturn [{ json: { ids } }];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[4320,680],"id":"21c033f8-0572-478a-9075-3af2967e757c","name":"IDs To Array1"},{"parameters":{"jsonSchemaExample":"{\n  \"Prompt\": \"insira o prompt aqui\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[3680,840],"id":"888386a9-24e5-4424-822b-eb3d42e5b653","name":"Structured Output Parser2"},{"parameters":{"jsCode":"const splitLength=5;const inputData=$input.first().json.Segments;const segments=[];let currentSegment={id:0,words:\"\",duration:0};let currentStartTime=-1;let totalDuration=0;let currentEndTime=0;const pauseBuffer=0.1;for(const wordObj of inputData){const{text,start_time,end_time}=wordObj;if(currentStartTime===-1){currentStartTime=start_time;}currentSegment.words+=(currentSegment.words?' ':'')+text;currentEndTime=end_time;currentSegment.duration=(currentEndTime-currentStartTime).toFixed(2);if(currentSegment.duration>=splitLength){currentSegment.duration=(parseFloat(currentSegment.duration)+pauseBuffer).toFixed(2);totalDuration+=parseFloat(currentSegment.duration);segments.push(currentSegment);currentSegment={id:segments.length,words:\"\",duration:0};currentStartTime=-1;}}if(currentSegment.words){currentSegment.duration=(currentEndTime-currentStartTime).toFixed(2);currentSegment.duration=(parseFloat(currentSegment.duration)+pauseBuffer).toFixed(2);totalDuration+=parseFloat(currentSegment.duration);segments.push(currentSegment);}const roundedTotalDuration=Math.round(totalDuration);const totalSeconds=Math.floor(roundedTotalDuration);const minutes=Math.floor(totalSeconds/60);const seconds=totalSeconds%60;const totalRuntimeString=`${minutes} minute${minutes!==1?'s':''}, ${seconds} second${seconds!==1?'s':''}`;return segments.map(s=>({json:{...s,totalDuration:roundedTotalDuration,totalRuntimeString}}));"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2300,740],"id":"981d537f-909a-43d0-bc71-bece82fe16bd","name":"Split into 5s Scenes"},{"parameters":{"url":"={{ $json['URL Legenda'] }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1880,740],"id":"37e30f99-2217-4d63-8c36-480ff152e172","name":"Get Segment File"},{"parameters":{"content":"## Gerar Cenas & Prompts das Imagens\n","height":360,"width":4380,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[420,620],"id":"fe25730a-481f-41cb-9158-ff84db4758d1","name":"Sticky Note4"},{"parameters":{"jsCode":"const inputSegments = $input.all();\n\nif (inputSegments.length > 0) {\n  const lastSegment = inputSegments[inputSegments.length - 1].json;\n\n  if (parseFloat(lastSegment.duration) < 2.0 && inputSegments.length > 1) {\n    const secondLastSegment = inputSegments[inputSegments.length - 2].json;\n\n    // Merge palavras\n    secondLastSegment.words += ' ' + lastSegment.words;\n    \n    // Soma das dura√ß√µes\n    secondLastSegment.duration = (\n      parseFloat(secondLastSegment.duration) + parseFloat(lastSegment.duration)\n    ).toFixed(2);\n\n    // Remove o √∫ltimo item\n    inputSegments.pop();\n  }\n}\n\n// Retorna os segmentos corrigidos (como array de items)\nreturn inputSegments;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2520,740],"id":"9406d742-dc3d-4321-87a4-3c63a4489730","name":"Fixer"},{"parameters":{"aggregate":"aggregateAllItemData","destinationFieldName":"Segments","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[2080,740],"id":"6e15fd52-ccf2-4022-8bec-68c13e1cb30e","name":"Aggregate"},{"parameters":{"content":"## together.ai - GERA√á√ÉO DE IMAGENS GR√ÅTIS","height":300,"width":1160,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1300,1540],"id":"5625c510-b117-4b62-8cd0-0a697d58b0c6","name":"Sticky Note5"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json[\"Provedor Imagem\"].value }}","rightValue":"together.ai2","operator":{"type":"string","operation":"equals"},"id":"eaf1a214-ae9e-455f-889b-5fb2f010b2a6"}],"combinator":"and"},"renameOutput":true,"outputKey":"togetherai2"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"3e78a869-ccdb-4d17-b4f0-bc61733f6232","leftValue":"={{ $json[\"Provedor Imagem\"].value }}","rightValue":"together.ai","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"togetherai"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[940,1600],"id":"bb451a54-aed7-4c90-b7d5-cbaef68cfbad","name":"Switch - Image Provider"},{"parameters":{"method":"POST","url":"https://api.together.xyz/v1/images/generations","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"model\": \"black-forest-labs/FLUX.1-schnell-Free\",\n    \"prompt\": {{ JSON.stringify($json.Prompt) }},\n    \"width\": 576,\n    \"height\": 1024,\n    \"steps\": 4,\n    \"n\": 1,\n    \"response_format\": \"b64_json\"\n   }","options":{"response":{"response":{"fullResponse":true}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1360,1620],"id":"ead919e2-8f7f-4d20-9b68-71a836be3409","name":"HTTP - Together.ai"},{"parameters":{"method":"POST","url":"http://host.docker.internal:85/api/user-files/upload-file/","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Token zR3mwIRhRnlixpCMmTar1ee7WegU1ZGy"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"parameterType":"formBinaryData","name":"file","inputDataFieldName":"data"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1920,1620],"id":"e5d45116-a796-4da4-a9c5-23a2b7acfe33","name":"HTTP - Upload To Baserow"},{"parameters":{"mode":"jsonToBinary","convertAllData":false,"sourceKey":"base64Image","options":{"dataIsBase64":true,"fileName":"image.png","mimeType":"image/png"}},"id":"c67d485b-b1fa-4d2d-97bb-28fe350cc7ca","name":"Convert String to binary","type":"n8n-nodes-base.moveBinaryData","typeVersion":1,"position":[1740,1620]},{"parameters":{"fields":{"values":[{"name":"base64Image","stringValue":"={{ $json.body.data[0].b64_json }}"}]},"options":{}},"id":"c26912db-286f-4bc7-906b-49345069dcab","name":"Base64 To String","type":"n8n-nodes-base.set","typeVersion":3.1,"position":[1560,1620]},{"parameters":{"amount":10},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[2280,1620],"id":"841698e7-488c-410f-949d-66aa589fcabb","name":"Wait1","webhookId":"bde535a6-423a-41f8-925f-a44961019398"},{"parameters":{"content":"## Gerar Imagens Usando Flux Schnell\n","height":900,"width":2180,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[420,1000],"id":"4f2b503c-9dca-4d18-bbd8-3fa24c034a4c","name":"Sticky Note11"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[900,1140],"id":"a3598b62-cc63-4594-a54f-c0821d689e98","name":"Loop Over Items"},{"parameters":{"fieldToSplitOut":"Cenas","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[3260,1100],"id":"0245e203-e6b2-4290-8020-2f14f5ec81dd","name":"Split Out2","executeOnce":true},{"parameters":{"method":"POST","url":"http://host.docker.internal:8080/v1/video/caption","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"video_url\": \"{{ $json['URL V√≠deo + Audio'] }}\",\n    \"settings\": {\n        \"line_color\": \"#FFFFFF\",\n        \"word_color\": \"#fff700\",\n        \"all_caps\": false,\n        \"max_words_per_line\": 3,\n        \"font_size\": 50,\n        \"bold\": false,\n        \"italic\": false,\n        \"underline\": false,\n        \"strikeout\": false,\n        \"outline_width\": 6,\n        \"shadow_offset\": 8,\n        \"style\": \"highlight\",\n        \"font_family\": \"The Bold Font\",\n        \"position\": \"top_center\"\n    },\n    \"id\": \"{{ $json.id }}\"\n}","options":{"timeout":90000}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[4280,1740],"id":"cae7c8a7-25d5-4e71-845d-d1759b76cdf3","name":"Create Captions"},{"parameters":{"fieldToSplitOut":"Cenas","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[3080,1440],"id":"8639350d-c86b-461d-8c2b-817e02b77889","name":"Split Out1","executeOnce":true},{"parameters":{"content":"## Juntar V√≠deo & Narra√ß√£o","height":240,"width":960,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2620,1660],"id":"dc730098-ebac-4d26-ae09-d65eed87415e","name":"Sticky Note7"},{"parameters":{"method":"POST","url":"http://host.docker.internal:8080/v1/ffmpeg/compose","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"id\": \"audio-layering\",\n    \"inputs\": [\n        {\n            \"file_url\": \"{{ $json.results[0][\"URL V√≠deo Bruto\"] }}\"\n        },\n        {\n            \"file_url\": \"{{ $json.results[0][\"TTS Audio\"][0].url }}\"\n        }\n    ],\n    \"filters\": [\n        {\n            \"filter\": \"[1:a]volume=1[outa]\"\n        }\n    ],\n    \"outputs\": [\n        {\n            \"options\": [\n                {\n                    \"option\": \"-map\",\n                    \"argument\": \"0:v\"\n                },\n                {\n                    \"option\": \"-map\",\n                    \"argument\": \"[outa]\"\n                },\n                {\n                    \"option\": \"-c:v\",\n                    \"argument\": \"copy\"\n                },\n                {\n                    \"option\": \"-c:a\",\n                    \"argument\": \"aac\"\n                }\n            ]\n        }\n    ]\n}\n","options":{"timeout":50000}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[3040,1740],"id":"fbdf488f-c558-4338-b843-57625af1693a","name":"Combine Clips3"},{"parameters":{"content":"## Adicionar Legenda","height":240,"width":1200,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[3600,1660],"id":"9ac1ea8c-a926-4c9a-9082-b07acaab8d0a","name":"Sticky Note6"},{"parameters":{"jsCode":"// Extract the array of URLs\nconst urls = items[0].json[\"URL V√≠deo Clip\"] || [];\n\n// Map URLs into the required structure\nconst formattedURLs = urls.map(url => ({ \"video_url\": url }));\n\n// Return the transformed data\nreturn [{\n    json: {\n        \"video_urls\": formattedURLs\n    }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[4100,1440],"id":"60bf4f44-68fe-4d3c-8539-35dc41d160c6","name":"Video url to array"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[3900,1100],"id":"ec1feae6-5b77-43bb-af01-115d097d49d9","name":"Loop Over Items3"},{"parameters":{"content":"## Juntar Clipes em 1 √önico V√≠deo","height":300,"width":2180,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2620,1340],"id":"83434e20-0730-4f74-9eda-50aba32f70a6","name":"Sticky Note3"},{"parameters":{"content":"## Criar Clipes Para as Imagens\n","height":320,"width":2180,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2620,1000],"id":"fd0dc562-e1ec-49e7-b7f6-5d0bbfcc43a3","name":"Sticky Note2"},{"parameters":{"method":"POST","url":"http://host.docker.internal:8080/v1/video/concatenate","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"video_urls\": {{ JSON.stringify($json.video_urls) }},\n    \"id\": \"{{ $('Buscar tabelas 4').item.json.results[0].id }}\"\n}","options":{"timeout":50000}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[4320,1440],"id":"8082109e-f849-41ab-8e8b-b8b4c21db053","name":"Combine Clips"},{"parameters":{"method":"POST","url":"http://host.docker.internal:8080/v1/image/transform/video","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"image_url\":\"{{ $json.results[0].Imagem[0].url }}\",\n    \"length\": {{ $json.results[0][\"Dura√ß√£o\"] }},\n    \"frame_rate\": 25,\n    \"zoom_speed\": 3,\n    \"id\": \"{{ $json.results[0].id }}\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[4220,1100],"id":"55102b07-9c6a-47dc-8194-ddcfd4fb5651","name":"Create Clips"},{"parameters":{"model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[1480,420],"id":"2aa266da-261d-4bf2-9b8d-4882c948c90c","name":"OpenAI Chat Model"},{"parameters":{"model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[3380,840],"id":"b34e084c-5385-4559-b174-d69d2e0cd509","name":"OpenAI Chat Model1"},{"parameters":{"method":"POST","url":"http://host.docker.internal:85/api/database/rows/table/314/?user_field_names=true","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Token zR3mwIRhRnlixpCMmTar1ee7WegU1ZGy"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"Descri√ß√£o","value":"={{ $node['Output Parser üõ†'].json.output.Description }}"},{"name":"Script","value":"={{ $json.Script }}"},{"name":"TTS Voz","value":"={{ $node['On form submission'].json['TTS Voz'] }}"},{"name":"Estilo","value":"={{ $node['On form submission'].json['Estilo Generativo'] }}"},{"name":"Prompt Inicial","value":"={{ $node['Set Idea'].json['User Input'] }}"},{"name":"Status","value":"={{ $('Set Idea').item.json.Status }}"},{"name":"Provedor Imagens","value":"={{ $('Provedor Image').item.json.togetherai }}"},{"name":"T√≠tulo","value":"={{ $node['Output Parser üõ†'].json.output.Title }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2300,180],"id":"06237eca-1895-411d-8e52-a595ce4cd512","name":"Criar tabelas baserow 1"},{"parameters":{"assignments":{"assignments":[{"id":"f94ae35a-b4b5-4f44-bb1c-4e929e95d718","name":"={{ $json['Provedor Imagens'] }}","value":"=2982","type":"number"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[660,180],"id":"6eaf7463-38d3-464d-aced-bb4fca978dd2","name":"Provedor Image"},{"parameters":{"url":"http://host.docker.internal:85/api/database/rows/table/314/?user_field_names=true&filter__field_6761__contains=Processando","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Token zR3mwIRhRnlixpCMmTar1ee7WegU1ZGy"},{"name":"Content-Type","value":"application/json"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2640,180],"id":"6b02373d-735e-4555-99b7-954f5b27057c","name":"Buscar tabelas 1"},{"parameters":{"method":"PATCH","url":"=http://host.docker.internal:85/api/database/rows/table/314/{{ $node[\"ID Tabela\"].json.id }}/?user_field_names=true\n\n\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Token zR3mwIRhRnlixpCMmTar1ee7WegU1ZGy"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"URL Legenda","value":"={{ $json.url }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[4560,180],"id":"4d3ab9ca-f9f4-4f34-8fc3-5a10e92cb556","name":"Atualizar URL Legenda"},{"parameters":{"assignments":{"assignments":[{"id":"2e9c60a8-b379-45ff-9fed-2d446f0a28fd","name":"id","value":"={{ $json.results[0].id }}","type":"number"},{"id":"af3afe9a-c525-4fcc-b860-a6602fe265de","name":"Script","value":"={{ $json.results[0].Script }}","type":"string"},{"id":"89705751-1791-47e9-aac0-e838feb35b94","name":"TTS Voz","value":"={{ $json.results[0]['TTS Voz'] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2880,180],"id":"6f2cb0df-9693-4f55-a757-af10031760c1","name":"ID Tabela"},{"parameters":{"method":"PATCH","url":"=http://host.docker.internal:85/api/database/rows/table/314/{{ $node[\"ID Tabela\"].json.id }}/?user_field_names=true\n\n\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Token zR3mwIRhRnlixpCMmTar1ee7WegU1ZGy"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"TTS Audio","value":"={{ $('Upload tts to baserow').item.json.name }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[3640,400],"id":"56cbc55b-4efc-4ad7-8a32-0091ec019c57","name":"Atualizar Tabela TTS"},{"parameters":{"url":"http://host.docker.internal:85/api/database/rows/table/314/?user_field_names=true&filter__field_6761__contains=Processando&filter__field_6765__empty=","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Token zR3mwIRhRnlixpCMmTar1ee7WegU1ZGy"},{"name":"Content-Type","value":"application/json"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[520,720],"id":"c7036bc8-a2d7-4172-baf4-a9a91c1b378b","name":"Buscar tabelas 2"},{"parameters":{"method":"PATCH","url":"=http://host.docker.internal:85/api/database/rows/table/314/{{ $json.id }}/?user_field_names=true\n\n\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Token zR3mwIRhRnlixpCMmTar1ee7WegU1ZGy"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"Status","value":"={{ $json.Status }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1660,740],"id":"70579238-74fd-4d8f-9271-fe5354783966","name":"Atualizar Status 1"},{"parameters":{"assignments":{"assignments":[{"id":"80b2541c-1803-4751-ace0-08bc1d6141e5","name":"id","value":"={{ $json.results[0].id }}","type":"number"},{"id":"2e9c60a8-b379-45ff-9fed-2d446f0a28fd","name":"URL Legenda","value":"={{ $json.results[0]['URL Legenda'] }}","type":"string"},{"id":"f5b1f0ce-ac06-41a8-967a-a36e9e986214","name":"Status","value":2986,"type":"number"},{"id":"9d4cc0e1-f268-42be-97e8-ae30afad1e74","name":"Script","value":"={{ $json.results[0].Script }}","type":"string"},{"id":"963970ab-e4ae-4870-a6f2-a6b6a2c8e6c9","name":"Estilo","value":"={{ $json.results[0].Estilo }}","type":"string"},{"id":"d37f52a4-70f6-48a4-9c27-f376dd40fa3e","name":"Provedor Imagem","value":"={{ $json.results[0][\"Provedor Imagens\"].value }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[760,720],"id":"de81ea01-aa49-4355-85ca-ec1bfef5f049","name":"ID + URL Legenda","alwaysOutputData":true},{"parameters":{"method":"POST","url":"http://host.docker.internal:85/api/database/rows/table/710/?user_field_names=true","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Token zR3mwIRhRnlixpCMmTar1ee7WegU1ZGy"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"Prompt","value":"={{ $json.output.Prompt }}"},{"name":"Dura√ß√£o","value":"={{ $('Prepare Scene').item.json.duration }}"},{"name":"Provedor Imagem","value":"={{ $('Renomear').item.json[\"object Object\"] }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[3880,680],"id":"7ea669a2-c4f9-48ff-b00d-8ab34e1f2540","name":"Criar tabelas baserow (Cenas)"},{"parameters":{"method":"PATCH","url":"=http://host.docker.internal:85/api/database/rows/table/314/{{ $('ID + URL Legenda').item.json.id }}/?user_field_names=true\n\n\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Token zR3mwIRhRnlixpCMmTar1ee7WegU1ZGy"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"Cenas","value":"={{ $json.ids }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[4560,680],"id":"efbcff89-f202-4eb6-9865-1be81b7d3eb7","name":"Atualizar IDs"},{"parameters":{"url":"http://host.docker.internal:85/api/database/rows/table/710/?user_field_names=true&filter__field_6757__empty=","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Token zR3mwIRhRnlixpCMmTar1ee7WegU1ZGy"},{"name":"Content-Type","value":"application/json"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[520,1140],"id":"e19cd182-52fa-4b1c-bcb7-f0a3f6720f82","name":"Buscar Cenas"},{"parameters":{"method":"PATCH","url":"=http://host.docker.internal:85/api/database/rows/table/710/{{ $('Loop Over Items').item.json.id }}/?user_field_names=true\n\n\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Token zR3mwIRhRnlixpCMmTar1ee7WegU1ZGy"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"Imagem","value":"={{ $json.name }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2100,1620],"id":"6c9568fb-5415-4721-b062-6f30cd16ea89","name":"Atualizar Tabela Imagem"},{"parameters":{"assignments":{"assignments":[{"id":"7e130a3c-eaea-460c-ba58-f46ea6f14f13","name":"id","value":"={{ $json.id }}","type":"number"},{"id":"60cb5799-8fe6-4cda-98a9-9463ba903ffc","name":"URL Legenda","value":"={{ $json[\"URL Legenda\"] }}","type":"string"},{"id":"1fd92ff1-e06f-492e-ace3-03720d47a2f5","name":"Status","value":"={{ $json.Status }}","type":"number"},{"id":"728f7259-735a-433b-bec8-ca20b6b4200a","name":"Script","value":"={{ $json.Script }}","type":"string"},{"id":"d6ae4773-7923-4abf-856f-18f3aece0c5c","name":"Estilo","value":"={{ $json.Estilo }}","type":"string"},{"id":"4d52ea57-5323-42b6-870d-6af3e18e2934","name":"={{ $json[\"Provedor Imagem\"] }}","value":"=togetherai","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1240,740],"id":"e9155f12-b8e9-4d70-83f6-fa1333f11544","name":"ID Provedor Imagem 2"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json[\"Provedor Imagem\"] }}","rightValue":"falaai","operator":{"type":"string","operation":"equals"},"id":"eaf1a214-ae9e-455f-889b-5fb2f010b2a6"}],"combinator":"and"},"renameOutput":true,"outputKey":"fal.ai"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"3e78a869-ccdb-4d17-b4f0-bc61733f6232","leftValue":"={{ $json[\"Provedor Imagem\"] }}","rightValue":"together.ai","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"togetherai"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[980,720],"id":"56975c2a-0511-42f2-a0c5-13435f896944","name":"Switch - Image Provider1"},{"parameters":{"assignments":{"assignments":[{"id":"1904e064-ef81-4c33-9791-dbaaf4f5339b","name":"id","value":"={{ $json.id }}","type":"number"},{"id":"f83d662c-e746-4b3d-a61f-6c0161858073","name":"URL Legenda","value":"={{ $json[\"URL Legenda\"] }}","type":"string"},{"id":"6685a3ab-b267-42d0-9013-760cec61d684","name":"Status","value":"={{ $json.Status }}","type":"number"},{"id":"ef5ef3ec-3630-4435-98c9-303cd0f6be4b","name":"={{ $json.together }}","value":"=2984","type":"number"},{"id":"556e9df7-c0c6-4ced-b844-42682898ca86","name":"Script","value":"={{ $json.Script }}","type":"string"},{"id":"3d47a95e-7c00-4ea3-a5c0-075aeafe8b5d","name":"Estilo","value":"={{ $json.Estilo }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1460,740],"id":"fa25fc4a-337e-414d-980f-eba25e88aba3","name":"Renomear"},{"parameters":{"fieldToSplitOut":"results","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[700,1140],"id":"07d78a11-d391-46e5-aaca-37bf5da56356","name":"Split Out3"},{"parameters":{"url":"http://host.docker.internal:85/api/database/rows/table/314/?user_field_names=true&filter__field_6761__contains=Prompt&filter__field_6749__empty=","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Token zR3mwIRhRnlixpCMmTar1ee7WegU1ZGy"},{"name":"Content-Type","value":"application/json"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2700,1100],"id":"c3be33a0-ed92-4ad0-b826-9e9de4dcc9dc","name":"Buscar tabelas 3"},{"parameters":{"method":"PATCH","url":"=http://host.docker.internal:85/api/database/rows/table/314/{{ $json.results[0].id }}/?user_field_names=true\n\n\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Token zR3mwIRhRnlixpCMmTar1ee7WegU1ZGy"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"Status","value":"Clipes"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2980,1100],"id":"0c2522f9-3d3b-4795-8ce2-3c07479acb99","name":"Atualizar Status 2"},{"parameters":{"url":"=http://host.docker.internal:85/api/database/rows/table/710/?user_field_names=true&filter__Record%20ID__equal={{ $json.id }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Token zR3mwIRhRnlixpCMmTar1ee7WegU1ZGy"},{"name":"Content-Type","value":"application/json"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[3560,1100],"id":"1752f30a-a71e-4a61-bc4a-44d07704ead0","name":"Record ID √© Igual?"},{"parameters":{"method":"PATCH","url":"=http://host.docker.internal:85/api/database/rows/table/710/{{ $json.id }}/?user_field_names=true\n\n\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Token zR3mwIRhRnlixpCMmTar1ee7WegU1ZGy"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"URL V√≠deo Clip","value":"={{ $json.response }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[4560,1100],"id":"1ce62890-5c9e-4e35-952a-d7d9240ce9d7","name":"Atualizar URL V√≠deo Clip"},{"parameters":{"url":"http://host.docker.internal:85/api/database/rows/table/314/?user_field_names=true&filter__field_6761__contains=Clipes&filter__field_6749__empty=","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Token zR3mwIRhRnlixpCMmTar1ee7WegU1ZGy"},{"name":"Content-Type","value":"application/json"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2700,1440],"id":"67b2e1fc-86b7-4941-aaa1-e1cbdad59773","name":"Buscar tabelas 4"},{"parameters":{"method":"PATCH","url":"=http://host.docker.internal:85/api/database/rows/table/314/{{ $json.results[0].id }}/?user_field_names=true\n\n\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Token zR3mwIRhRnlixpCMmTar1ee7WegU1ZGy"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"Status","value":"Combine"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2880,1440],"id":"4a454ac5-c1bd-42ff-a8d2-0c12a3f1f9a7","name":"Atualizar Status 3"},{"parameters":{"url":"=http://host.docker.internal:85/api/database/rows/table/710/?user_field_names=true&filter__Record%20ID__equal={{ $json.id }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Token zR3mwIRhRnlixpCMmTar1ee7WegU1ZGy"},{"name":"Content-Type","value":"application/json"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[3280,1440],"id":"4c453c57-b1f3-4222-8f5f-e492677bf36a","name":"Record ID √© Igual? (2)"},{"parameters":{"method":"PATCH","url":"=http://host.docker.internal:85/api/database/rows/table/314/{{ $json.id }}/?user_field_names=true\n\n\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Token zR3mwIRhRnlixpCMmTar1ee7WegU1ZGy"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"URL V√≠deo Bruto","value":"={{ $json.response }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[4540,1440],"id":"890003f0-6110-43e3-876b-063044be7bf3","name":"Atualizar URL V√≠deo Bruto"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"URL V√≠deo Clip"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[3880,1440],"id":"252f2cbf-e665-4fdf-b08b-44583ac6c5ac","name":"Aggregate2"},{"parameters":{"assignments":{"assignments":[{"id":"25c09a32-7ec5-40ac-a648-d1f62d74575e","name":"results","value":"={{ $json.results }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3480,1440],"id":"b7255637-3a00-4785-83b2-b58ee057e8f7","name":"Separar Results"},{"parameters":{"fieldToSplitOut":"results","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[3680,1440],"id":"03403aec-47d5-4699-8c27-24946fb3ec95","name":"Split Out6"},{"parameters":{"url":"http://host.docker.internal:85/api/database/rows/table/314/?user_field_names=true&filter__field_6750__empty=","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Token zR3mwIRhRnlixpCMmTar1ee7WegU1ZGy"},{"name":"Content-Type","value":"application/json"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2700,1740],"id":"b2fcb2f0-a426-4877-9661-bed700240c95","name":"Buscar tabelas 5"},{"parameters":{"method":"PATCH","url":"=http://host.docker.internal:85/api/database/rows/table/314/{{ $('Buscar tabelas 5').item.json.results[0].id }}/?user_field_names=true\n\n\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Token zR3mwIRhRnlixpCMmTar1ee7WegU1ZGy"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"URL V√≠deo + Audio","value":"={{ $json.response[0].file_url }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[3360,1740],"id":"93cc48b1-0ff1-4888-892e-661a220d9280","name":"Atualizar URL V√≠deo + Audio"},{"parameters":{"method":"PATCH","url":"=http://host.docker.internal:85/api/database/rows/table/314/{{ $('Buscar tabelas 6').item.json.results[0].id }}/?user_field_names=true\n\n\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Token zR3mwIRhRnlixpCMmTar1ee7WegU1ZGy"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"URL V√≠deo Legenda","value":"={{ $json.response }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[4540,1740],"id":"5bac9957-2f26-410a-bca1-c27fa77460e7","name":"Atualizar URL V√≠deo Legenda"},{"parameters":{"url":"http://host.docker.internal:85/api/database/rows/table/314/?user_field_names=true&filter__field_6761__contains=Combine&filter__field_6748__empty=","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Token zR3mwIRhRnlixpCMmTar1ee7WegU1ZGy"},{"name":"Content-Type","value":"application/json"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[3740,1740],"id":"b1f97aa6-1426-4209-9eb5-984ccb401009","name":"Buscar tabelas 6"},{"parameters":{"method":"PATCH","url":"=http://host.docker.internal:85/api/database/rows/table/314/{{ $json.results[0].id }}/?user_field_names=true\n\n\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Token zR3mwIRhRnlixpCMmTar1ee7WegU1ZGy"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"Status","value":"Legenda"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[4020,1740],"id":"77518233-1914-4776-bd03-77e222f29dc3","name":"Atualizar Status 4"},{"parameters":{"functionCode":"const script = $('ID + URL Legenda').item.json.Script;\nconst estilo = $('ID + URL Legenda').item.json.Estilo;\nreturn items.map(item => {\n  item.json.contextLoaded = 'loaded';\n  item.json.script = script;\n  item.json.estilo = estilo;\n  return item;\n});"},"id":"53e8cbd6-9313-4ece-843f-ffb4667c15ac","name":"Context Loader1","type":"n8n-nodes-base.function","typeVersion":1,"position":[2720,740]},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.contextLoaded }}","value2":"loaded"}]}},"id":"a2efd715-84e9-4bd1-896f-0f5264feba17","name":"If Context Loaded1","type":"n8n-nodes-base.if","typeVersion":1,"position":[2920,740]},{"parameters":{"functionCode":"return items.map(item => ({\n  json: {\n    words: item.json.words,\n    id: item.json.id,\n    duration: item.json.duration,\n    script: item.json.script,\n    estilo: item.json.estilo\n  }\n}));"},"id":"dc165945-4c84-44ec-a06a-0a10c6b8657f","name":"Prepare Scene","type":"n8n-nodes-base.function","typeVersion":1,"position":[3240,680]},{"parameters":{"promptType":"define","text":"=Use o SCRIPT e o ESTILO previamente carregados.\n\nSCRIPT:\n{{ $json.script }}\n\nESTILO:\n{{ $json.estilo }}\n\nAqui est√° a cena atual:\nParte do roteiro: {{ $json.words }},safe for work, family-friendly, no nudity, dynamic angle, dramatic lighting, immersive textures, cinematic, pastel tones, bokeh, depth of field\nPosi√ß√£o no script: {{ $json.id }}\n\nGere um prompt de imagem descritivo para esta cena, seguindo o estilo indicado.","hasOutputParser":true,"messages":{"messageValues":[{"message":"=You are an image-prompt generator for video scenes. For each script snippet, return:\n\n{\n  \"Prompt\": \"...up to 240 characters...\"\n}\n\nEssential rules\n‚â§ 240 characters ¬∑ no text in the image\n\nExplicitly mark: ‚Äúsafe for work‚Äù, ‚Äúfamily-friendly‚Äù, ‚Äúno nudity‚Äù, ‚Äúno text‚Äù, ‚Äúno watermarks‚Äù, ‚Äúno extra limbs‚Äù\n\nCite the given art style (e.g., Cartoon Flat, Hyper-Realistic, Hand-Drawn)\n\nCreate an impactful image: dynamic composition, dramatic angles, striking lighting, rich textures, environmental storytelling\n\nSmall themes ‚Üí microuniverse: use lighting, framing, and atmosphere to expand the scene\n\nFocus on depth, detail, and artistic impact; avoid irrelevant complexity\n\nPrompt checklist (include when relevant)\nMain theme\n\nArt style\n\nComposition (close-up, over-the-shoulder, low perspective, etc.)\n\nLighting (backlight, neon, deep shadows, reflections)\n\nMicrouniverse / environmental narrative\n\nDominant color palette\n\nEmotional mood / atmosphere\n\nCamera technique (bokeh, depth of field, contrast, lens distortion)\n\nSubtle extra elements that enrich without clutter\n\nUltra-short examples\nHyper-Realistic: ‚ÄúMacro shot of glue drop hanging from cracked porcelain teacup, golden desk-lamp glow, floating dust motes, shallow focus, warm atmosphere.‚Äù\n\nCyberpunk: ‚ÄúNeon-soaked alley blue/magenta, hoverbike headlights slice mist, silhouette in metallic trench coat, low angle, bright reflections.‚Äù\n\nFollow these points and keep every prompt short, vivid, and cinematic."}]}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.5,"position":[3460,680],"id":"a8fb3193-0038-478d-a29f-e42611b79500","name":"Image Prompter V3 üì∑","onError":"continueRegularOutput"},{"parameters":{"jsCode":"// 1. Coleta todas as palavras da legenda\nconst palavrasOriginais = items.map(i => i.json.word);\n\n// 2. Junta tudo em um √∫nico array de palavras\nconst palavras = palavrasOriginais.join(' ').split(' ');\n\n// 3. Agrupa em blocos de at√© 3 palavras\nconst grupos = [];\nfor (let i = 0; i < palavras.length; i += 3) {\n  grupos.push(palavras.slice(i, i + 3).join(' '));\n}\n\n// 4. Define a dura√ß√£o total com base no √∫ltimo item de Frases Curtas\nconst duracaoTotal = items[items.length - 1].json.end_time || 10;\nconst duracaoPorGrupo = duracaoTotal / grupos.length;\n\n// 5. Gera os objetos com text, start e end\nreturn grupos.map((texto, i) => {\n  return {\n    json: {\n      text: texto,\n      start: +(i * duracaoPorGrupo).toFixed(3),\n      end: +((i + 1) * duracaoPorGrupo).toFixed(3)\n    }\n  };\n});"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[3860,180],"id":"8b308ff1-81cf-4280-9f17-06852d64fe89","name":"3 Palavras/Linha"}],"connections":{"Set Idea":{"main":[[{"node":"Provedor Image","type":"main","index":0}]]},"On form submission":{"main":[[{"node":"Set Idea","type":"main","index":0}]]},"Structured Output Parser1":{"ai_outputParser":[[{"node":"Output Parser üõ†","type":"ai_outputParser","index":0}]]},"Script Writier üß†":{"main":[[{"node":"Output Parser üõ†","type":"main","index":0}]]},"Output Parser üõ†":{"main":[[{"node":"Combine","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Long form to Script Writier üß†","type":"main","index":0}],[{"node":"Script Writier üß†","type":"main","index":0}]]},"Long form to Script Writier üß†":{"main":[[{"node":"Output Parser üõ†","type":"main","index":0}]]},"Combine":{"main":[[{"node":"Format Cleanup","type":"main","index":0}]]},"Format Cleanup":{"main":[[{"node":"Criar tabelas baserow 1","type":"main","index":0}]]},"Upload captions To Baserow":{"main":[[{"node":"Atualizar URL Legenda","type":"main","index":0}]]},"Upload tts to baserow":{"main":[[{"node":"Atualizar Tabela TTS","type":"main","index":0}]]},"Generate TTS":{"main":[[{"node":"Upload tts to baserow","type":"main","index":0},{"node":"Criar Legenda","type":"main","index":0}]]},"Criar Legenda":{"main":[[{"node":"Frases Curtas","type":"main","index":0}]]},"Frases Curtas":{"main":[[{"node":"3 Palavras/Linha","type":"main","index":0}]]},"Legenda.json":{"main":[[{"node":"Upload captions To Baserow","type":"main","index":0}]]},"Aggregate3":{"main":[[{"node":"IDs To Array1","type":"main","index":0}]]},"IDs To Array1":{"main":[[{"node":"Atualizar IDs","type":"main","index":0}]]},"Structured Output Parser2":{"ai_outputParser":[[{"node":"Image Prompter V3 üì∑","type":"ai_outputParser","index":0}]]},"Split into 5s Scenes":{"main":[[{"node":"Fixer","type":"main","index":0}]]},"Get Segment File":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Fixer":{"main":[[{"node":"Context Loader1","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Split into 5s Scenes","type":"main","index":0}]]},"Switch - Image Provider":{"main":[[],[{"node":"HTTP - Together.ai","type":"main","index":0}]]},"HTTP - Together.ai":{"main":[[{"node":"Base64 To String","type":"main","index":0}]]},"HTTP - Upload To Baserow":{"main":[[{"node":"Atualizar Tabela Imagem","type":"main","index":0}]]},"Convert String to binary":{"main":[[{"node":"HTTP - Upload To Baserow","type":"main","index":0}]]},"Base64 To String":{"main":[[{"node":"Convert String to binary","type":"main","index":0}]]},"Wait1":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Loop Over Items":{"main":[[{"node":"Buscar tabelas 3","type":"main","index":0}],[{"node":"Switch - Image Provider","type":"main","index":0}]]},"Split Out2":{"main":[[{"node":"Record ID √© Igual?","type":"main","index":0}]]},"Create Captions":{"main":[[{"node":"Atualizar URL V√≠deo Legenda","type":"main","index":0}]]},"Split Out1":{"main":[[{"node":"Record ID √© Igual? (2)","type":"main","index":0}]]},"Combine Clips3":{"main":[[{"node":"Atualizar URL V√≠deo + Audio","type":"main","index":0}]]},"Video url to array":{"main":[[{"node":"Combine Clips","type":"main","index":0}]]},"Loop Over Items3":{"main":[[{"node":"Buscar tabelas 4","type":"main","index":0}],[{"node":"Create Clips","type":"main","index":0}]]},"Combine Clips":{"main":[[{"node":"Atualizar URL V√≠deo Bruto","type":"main","index":0}]]},"Create Clips":{"main":[[{"node":"Atualizar URL V√≠deo Clip","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Output Parser üõ†","type":"ai_languageModel","index":0},{"node":"Script Writier üß†","type":"ai_languageModel","index":0},{"node":"Long form to Script Writier üß†","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Image Prompter V3 üì∑","type":"ai_languageModel","index":0}]]},"Provedor Image":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Criar tabelas baserow 1":{"main":[[{"node":"Buscar tabelas 1","type":"main","index":0}]]},"Buscar tabelas 1":{"main":[[{"node":"ID Tabela","type":"main","index":0}]]},"ID Tabela":{"main":[[{"node":"Generate TTS","type":"main","index":0}]]},"Buscar tabelas 2":{"main":[[{"node":"ID + URL Legenda","type":"main","index":0}]]},"ID + URL Legenda":{"main":[[{"node":"Switch - Image Provider1","type":"main","index":0}]]},"Atualizar Status 1":{"main":[[{"node":"Get Segment File","type":"main","index":0}]]},"Criar tabelas baserow (Cenas)":{"main":[[{"node":"Aggregate3","type":"main","index":0}]]},"Atualizar Tabela TTS":{"main":[[{"node":"Buscar tabelas 2","type":"main","index":0}]]},"Buscar Cenas":{"main":[[{"node":"Split Out3","type":"main","index":0}]]},"Atualizar Tabela Imagem":{"main":[[{"node":"Wait1","type":"main","index":0}]]},"ID Provedor Imagem 2":{"main":[[{"node":"Renomear","type":"main","index":0}]]},"Switch - Image Provider1":{"main":[[],[{"node":"ID Provedor Imagem 2","type":"main","index":0}]]},"Renomear":{"main":[[{"node":"Atualizar Status 1","type":"main","index":0}]]},"Split Out3":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Buscar tabelas 3":{"main":[[{"node":"Atualizar Status 2","type":"main","index":0}]]},"Atualizar Status 2":{"main":[[{"node":"Split Out2","type":"main","index":0}]]},"Record ID √© Igual?":{"main":[[{"node":"Loop Over Items3","type":"main","index":0}]]},"Atualizar URL V√≠deo Clip":{"main":[[{"node":"Loop Over Items3","type":"main","index":0}]]},"Buscar tabelas 4":{"main":[[{"node":"Atualizar Status 3","type":"main","index":0}]]},"Atualizar Status 3":{"main":[[{"node":"Split Out1","type":"main","index":0}]]},"Record ID √© Igual? (2)":{"main":[[{"node":"Separar Results","type":"main","index":0}]]},"Aggregate2":{"main":[[{"node":"Video url to array","type":"main","index":0}]]},"Separar Results":{"main":[[{"node":"Split Out6","type":"main","index":0}]]},"Split Out6":{"main":[[{"node":"Aggregate2","type":"main","index":0}]]},"Buscar tabelas 5":{"main":[[{"node":"Combine Clips3","type":"main","index":0}]]},"Atualizar URL V√≠deo Bruto":{"main":[[{"node":"Buscar tabelas 5","type":"main","index":0}]]},"Buscar tabelas 6":{"main":[[{"node":"Atualizar Status 4","type":"main","index":0}]]},"Atualizar Status 4":{"main":[[{"node":"Create Captions","type":"main","index":0}]]},"Atualizar URL V√≠deo + Audio":{"main":[[{"node":"Buscar tabelas 6","type":"main","index":0}]]},"Context Loader1":{"main":[[{"node":"If Context Loaded1","type":"main","index":0}]]},"If Context Loaded1":{"main":[[{"node":"Prepare Scene","type":"main","index":0}]]},"Prepare Scene":{"main":[[{"node":"Image Prompter V3 üì∑","type":"main","index":0}]]},"Image Prompter V3 üì∑":{"main":[[{"node":"Criar tabelas baserow (Cenas)","type":"main","index":0}]]},"3 Palavras/Linha":{"main":[[{"node":"Legenda.json","type":"main","index":0}]]},"Atualizar IDs":{"main":[[{"node":"Buscar Cenas","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"d26d34aa-9ad8-4d8e-8902-644d53fa9bea","triggerCount":0,"tags":[]}